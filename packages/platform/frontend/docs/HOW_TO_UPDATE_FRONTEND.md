# 前端更新完成 - 测试指南

## ✅ 已完成的更新

### 文件修改
- **文件**：`packages/platform/frontend/src/views/SkillsView.vue`
- **添加内容**：
  - ✅ 导入 `SkillSyncButton` 组件
  - ✅ 导入 `useUserStore`（权限检查）
  - ✅ 在页面头部添加同步按钮
  - ✅ 仅管理员可见（`v-if="userStore.is_superuser"`）
  - ✅ 同步成功后自动刷新列表（`@success="fetchData"`）

## 🚀 现在就可以测试了！

### 第一步：确保服务运行中

```bash
# 终端 1 - 后端
cd packages/platform/backend
uv run uvicorn main:app --reload --port 8000

# 终端 2 - 前端（如果还没启动）
cd packages/platform/frontend
npm run dev
```

### 第二步：访问技能管理页面

1. 打开浏览器访问：**http://localhost:5173**
2. 登录管理员账户（或注册后设置为管理员）
3. 导航到：**技能管理** 页面
4. 应该能在页面右上角看到 **"同步技能"** 按钮

### 第三步：测试同步功能

#### 选项 1：同步新技能
1. 点击"同步技能"按钮
2. 选择 **"仅同步新技能"**
3. 确认同步
4. 查看同步结果对话框

#### 选项 2：强制更新所有技能
1. 点击按钮右侧的 ▼ 下拉箭头
2. 选择 **"强制更新所有技能"**
3. 确认操作（有警告提示）
4. 查看更新结果

#### 选项 3：查看同步状态
1. 点击下拉菜单中的 **"查看同步状态"**
2. 查看 Framework 中有多少可同步的技能

## 📸 预期效果

### 页面布局
```
┌─────────────────────────────────────────────┐
│ 技能管理                                     │
│                                              │
│ [同步技能▼] [创建技能]  ← 新增的同步按钮      │
└─────────────────────────────────────────────┘
```

### 同步按钮下拉菜单
```
┌──────────────────┐
│ 🔄 同步技能       │
├──────────────────┤
│ 🔄 仅同步新技能   │
│ 🔄 强制更新所有   │
│ ──────────────── │
│ ℹ️  查看同步状态  │
└──────────────────┘
```

### 同步结果对话框
```
┌────────────────────────────┐
│ 同步结果                    │
├────────────────────────────┤
│ ✓ 创建 18 个新技能          │
│                            │
│ ┌──────────────────────┐  │
│ │ 总计    | 18          │  │
│ │ 已创建  | 18 (绿色)   │  │
│ │ 已更新  | 0 (蓝色)    │  │
│ │ 已跳过  | 0 (灰色)    │  │
│ │ 失败    | 0 (红色)    │  │
│ └──────────────────────┘  │
│                            │
│ [关闭] [刷新列表]           │
└────────────────────────────┘
```

## 🔐 权限说明

**重要**：同步按钮只对管理员用户显示！

### 检查当前用户权限
```bash
# 方式 1：在浏览器控制台
import { useUserStore } from '@/stores'
const userStore = useUserStore()
console.log('Is Admin:', userStore.is_superuser)

# 方式 2：查看 API 响应
GET /api/v1/auth/me
```

### 设置用户为管理员（如果还不是）
```bash
# 使用 SQLite 工具打开数据库
cd packages/platform/backend
sqlite lingnexus_platform.db

# 更新用户
UPDATE users SET is_superuser = 1 WHERE username = 'your_username';
```

## 🐛 故障排除

### 问题 1：看不到同步按钮
**原因**：当前用户不是管理员
**解决**：
1. 使用管理员账户登录
2. 或在数据库中设置 `is_superuser = 1`

### 问题 2：点击后提示权限不足
**原因**：后端验证失败
**解决**：确认 Token 有效且用户是管理员

### 问题 3：同步失败
**原因**：Framework 路径不正确
**解决**：
1. 检查 `packages/platform/backend/services/skill_sync.py` 第 130 行
2. 确认路径指向正确的 Framework 目录

### 问题 4：前端页面空白
**原因**：组件导入错误
**解决**：
1. 检查浏览器控制台错误
2. 确认 `SkillSyncButton.vue` 文件存在
3. 重新运行 `npm install`

## 🎯 完整测试流程

1. **✅ 登录系统**（使用管理员账户）
2. **✅ 访问技能管理页面**（/skills）
3. **✅ 确认同步按钮可见**（右上角）
4. **✅ 点击"查看同步状态"**（查看可同步技能数）
5. **✅ 点击"仅同步新技能"**（导入新技能）
6. **✅ 查看同步结果**（统计信息）
7. **✅ 刷新技能列表**（自动刷新或手动）
8. **✅ 验证技能已导入**（列表中显示新技能）

## 📊 验证数据

同步成功后，可以通过以下方式验证：

### 方式 1：前端查看
- 技能管理页面列表
- 技能市场页面

### 方式 2：API 查看
```bash
curl http://localhost:8000/api/v1/skills \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 方式 3：数据库查看
```bash
sqlite lingnexus_platform.db "SELECT name, category, is_official FROM skills;"
```

## 🎉 成功标志

当你看到以下情况，说明功能正常：
- ✅ 同步按钮显示在页面右上角
- ✅ 下拉菜单可以展开
- ✅ 点击后显示确认对话框
- ✅ 同步进度正常显示
- ✅ 结果对话框显示详细统计
- ✅ 技能列表自动刷新
- ✅ 新技能出现在列表中

## 📝 下一步

同步完成后，你可以：
1. **浏览技能** - 在技能管理页面查看所有技能
2. **创建 Agent** - 从技能创建 Agent
3. **编辑技能** - 修改技能内容
4. **测试技能** - 在技能市场试用

## 🔗 相关文档

- [快速测试指南](../SKILL_SYNC_QUICKSTART.md)
- [完整使用指南](SKILL_SYNC_GUIDE.md)
- [实现总结](../SKILL_SYNC_IMPLEMENTATION.md)

---

**现在就可以测试了！访问 http://localhost:5173/skills 开始使用 🚀**
